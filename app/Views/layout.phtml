<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title><?php echo htmlspecialchars($title ?? (\App\Core\Env::get('APP_NAME', 'apks/apks_mvcoop'))); ?></title>
  <style>
    :root{--bg:#f7f7f9;--text:#222;--muted:#6b7280;--card:#fff;--border:#e5e7eb;--shadow:0 1px 2px rgba(0,0,0,.04);--nav:#0f172a;--nav-text:#e5e7eb;--sidebar:#111827;--sidebar-text:#d1d5db;--accent:#22c55e}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;line-height:1.5;margin:0;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    .muted{color:var(--muted)}
    /* Navbar */
    .navbar{position:sticky;top:0;z-index:10;background:var(--nav);color:var(--nav-text);padding:.75rem 1rem;box-shadow:var(--shadow)}
    .navbar .brand{font-weight:700;letter-spacing:.2px}
    .navbar .menu{display:flex;gap:1rem;align-items:center}
    .navbar .right{margin-left:auto;display:flex;gap:1rem}
    .navbar a{color:var(--nav-text);opacity:.95}
    .navbar a:hover{opacity:1}
    /* Layout */
    .layout{display:flex;min-height:calc(100vh - 56px)}
    /* Sidebar */
    .sidebar{width:240px;background:var(--sidebar);color:var(--sidebar-text);padding:1rem .75rem;position:sticky;top:56px;height:calc(100vh - 56px);overflow:auto}
    .sidebar .section{margin-bottom:1rem}
    .sidebar .section h4{font-size:.85rem;color:#9ca3af;text-transform:uppercase;margin:.75rem .5rem}
    .sidebar ul{list-style:none;margin:0;padding:0}
    .sidebar li{margin:.25rem 0}
    .sidebar a{display:block;padding:.5rem .75rem;border-radius:8px;color:var(--sidebar-text)}
    .sidebar a:hover{background:#1f2937}
    /* Main content area */
    .main{flex:1;padding:1rem}
    .card{max-width:960px;margin:0;background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);overflow:hidden}
    .card header{padding:1rem 1.25rem;border-bottom:1px solid #f0f0f0;font-weight:600}
    .card .content{padding:1.25rem}
    .card footer{padding:.75rem 1.25rem;border-top:1px solid #f0f0f0;font-size:.9rem;color:var(--muted);background:#fafafa}
    code{background:#f3f4f6;padding:.125rem .375rem;border-radius:6px}
    /* Small screens */
    @media(max-width: 900px){.sidebar{display:none}.layout{display:block}.main{padding:1rem}}
  </style>
</head>
<body>
  <?php
    // Determine repository name: prefer composer.json name; fallback to APP_NAME
    $repoName = null;
    $composerPath = dirname(__DIR__, 2) . DIRECTORY_SEPARATOR . 'composer.json';
    if (is_file($composerPath) && is_readable($composerPath)) {
        $json = @file_get_contents($composerPath);
        if ($json !== false) {
            $data = @json_decode($json, true);
            if (is_array($data) && isset($data['name']) && $data['name'] !== '') {
                $repoName = $data['name'];
            }
        }
    }
    if ($repoName === null || $repoName === '') {
        $repoName = \App\Core\Env::get('APP_NAME', 'apks/apks_mvcoop');
    }
    $appName = \App\Core\Env::get('APP_NAME', 'apks/apks_mvcoop');
    // Load menu configuration per locale
    $currentLang = \App\Core\I18n::getLocale();
    $menuFile = dirname(__DIR__, 2) . DIRECTORY_SEPARATOR . 'config' . DIRECTORY_SEPARATOR . 'menu-' . $currentLang . '.json';
    if (!is_file($menuFile)) {
        $menuFile = dirname(__DIR__, 2) . DIRECTORY_SEPARATOR . 'config' . DIRECTORY_SEPARATOR . 'menu-en.json';
    }
    $menuJson = @file_get_contents($menuFile);
    $menu = array();
    if ($menuJson !== false) {
        $decoded = @json_decode($menuJson, true);
        if (is_array($decoded)) { $menu = $decoded; }
    }
  ?>
  <!-- Top Navbar: Users and General menu -->
  <nav class="navbar">
    <?php include __DIR__ . DIRECTORY_SEPARATOR . 'partials' . DIRECTORY_SEPARATOR . 'menu-navbar.phtml'; ?>
  </nav>

  <div class="layout">
    <!-- Sidebar: System menu (IIoT focus) -->
    <aside class="sidebar">
      <?php include __DIR__ . DIRECTORY_SEPARATOR . 'partials' . DIRECTORY_SEPARATOR . 'menu-sidebar.phtml'; ?>
    </aside>

    <main class="main">
      <div class="card">
        <header><?php echo htmlspecialchars($title ?? (\App\Core\Env::get('APP_NAME', 'apks/apks_mvcoop'))); ?></header>
        <div class="content">
          <?php echo $content ?? ''; ?>
        </div>
        <footer>
          <?php include __DIR__ . DIRECTORY_SEPARATOR . 'partials' . DIRECTORY_SEPARATOR . 'menu-footer.phtml'; ?>
        </footer>
      </div>
    </main>
  </div>
</body>
</html>
